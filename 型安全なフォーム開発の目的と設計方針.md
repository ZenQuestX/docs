# 型安全なフォーム開発の目的と設計方針

## 概要
Pydanticで定義したデータスキーマをSingle Source of Truthとし、JSON Schemaを介してTypeScript（Zod）へ型情報を変換。ZodとCloudscape Design Systemを用いて、クライアント側のフォーム構築・入力バリデーション・UI一貫性を自動担保。さらに、JSON Schemaを活用してフォームの自動生成とバリデーションを一元化し、Amazon Cognitoの権限情報（ユーザーロール、グループ、属性）に基づくボタンの表示・操作制御を統合。

## 目的
- **型安全性の確保**  
  サーバーとクライアントでスキーマの一貫性を保ち、型の不整合やバリデーションの重複を排除。
- **開発・保守効率の向上**  
  単一のJSON Schemaからフォーム構成、型定義、バリデーション、UIを自動生成。スキーマ修正やCognito設定の更新で変更を反映。
- **UI一貫性と拡張性の両立**  
  Cloudscape Design Systemで標準化されたUIを自動生成し、スキーマ拡張やUIカスタマイズに柔軟に対応。
- **権限ベースのUI制御**  
  Cognitoの権限情報に基づき、ボタンの表示/非表示や活性/非活性を制御し、セキュリティとユーザー体験を向上。
- **フォーム作成の自動化**  
  JSON Schemaを基にフォームを自動生成し、バリデーションとUI構築を一元化。

## 利用技術・構成
- **バックエンド**: Python, Pydantic, FastAPI, AWS SDK (Boto3)  
- **共通形式**: JSON Schema（Pydanticから生成）  
- **フロントエンド**: TypeScript, Zod, Cloudscape Design System, React, AWS Amplify (Cognito認証)  
- **変換**: JSON SchemaからZodスキーマを生成  
- **権限管理**: Cognitoユーザープール（グループ、カスタム属性）、JWTトークン  
- **権限制御**: JWTトークンから取得したクレーム（例: グループ、ロール）を使用

## 運用イメージ
1. **バックエンド**:
   - Pydanticモデルでフォームスキーマを定義し、JSON Schemaとして公開。
   - Cognitoユーザープールでグループやカスタム属性を定義し、権限情報を管理。
   - フォームやボタンの表示条件を含むメタデータをクライアントに提供。

2. **フロントエンド**:
   - AWS AmplifyでCognito認証を行い、JWTトークンから権限情報を取得。
   - JSON SchemaからZodスキーマを生成し、Cloudscapeでフォームを自動生成。JSON Schemaに基づき入力フィールドやバリデーションルールを構築。
   - 権限情報に基づき、ボタンの表示や操作可否を制御。
   - 入力データをZodで検証後、API経由でサーバーに送信。

3. **サーバー検証**:
   - Pydanticでデータ検証、Cognitoトークンで権限検証を実施。
   - 特定の操作に必要な権限をチェックし、セキュリティを確保。

## 効果
- **型安全と権限制御の統合**: 型安全なフォーム開発にCognitoの権限制御を統合。
- **フォーム作成とバリデーションの一元化**: 単一のJSON Schemaからフォームの構造、バリデーション、UIを自動生成し、開発工数を削減。
- **柔軟なUI制御**: ユーザーロールに応じたUI制御でユーザー体験を最適化。
- **保守性向上**: 権限ルールはCognitoで、フォーム構成はJSON Schemaで一元管理。
- **セキュリティ向上**: クライアントとサーバー双方で権限を検証。

## 注意点
- **トークン検証**: クライアント側の権限チェックはUI制御用とし、サーバー側で再検証。
- **パフォーマンス**: トークン取得やAPI呼び出しの遅延を考慮し、キャッシュを活用。
- **スキーマ拡張**: JSON Schemaにフォーム表示条件や権限メタデータを追加可能。
