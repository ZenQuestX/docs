# BSS-FormFlow

## 概要

**BSS-FormFlow**は、サーバーとフロントエンド（Web画面）で同じデータの型（スキーマ）情報を使い回しながら、安全で柔軟なフォーム（入力画面）を自動生成・管理できる仕組みです。

主な特徴は、

* サーバー側（Python）とフロントエンド側（TypeScript）で同じデータ構造を共有できる
* 権限（ユーザーの役割）によってフォームの表示や操作内容を自動で切り替えられる
* 変更や保守が簡単になる
  という点です。

---

## 導入背景・目的

### 背景

現在の業務アプリケーション開発では、フォーム（入力画面）に関連する仕様が複雑化しており、以下のような課題が顕在化しています。

* サーバー（バックエンド）とフロントエンドで同じデータ構造やバリデーションルールを**二重に定義**している
* 入力内容の確認や制御のために、**バリデーションロジックが重複実装**されている
* 権限（ユーザーの役割）に応じたフォームの表示・制御が**個別実装となり、保守が困難**
* API仕様と実装の間で**乖離が発生しやすく、ドキュメント管理の負担が大きい**

こうした状況は、開発・改修におけるコストやミスのリスクを高め、変更への対応力を下げる要因になっています。

### 目的

**BSS-FormFlow**を導入する目的は、
\*\*「フォーム開発の重複作業を減らし、開発を簡単に、安全に、柔軟に進められる環境をつくること」\*\*です。

具体的には以下を実現します：

* **型定義・バリデーションの一元化**
* **フォームUIの自動生成**
* **権限ベースの動的UI制御**
* **API仕様と実装の自動連携**

このように、「型安全性・UI柔軟性・権限制御・保守性」を統合することで、
プロジェクト全体の開発効率・品質・変更耐性を大きく向上させることを目指します。

---

## 用語解説

* **フォーム**: Webサイトやアプリで、ユーザーが情報を入力する画面（例：会員登録フォーム、アンケートなど）
* **型（スキーマ）**: データの「設計図」。どんな項目があり、どのような値が入るかを決めるもの
* **Pydantic**: Pythonのライブラリ。データの型やルール（バリデーション）を定義できる
* **JSON Schema**: データの型情報をJSON形式で表現するための標準仕様
* **TypeScript/Zod**: TypeScriptはJavaScriptの拡張言語。ZodはTypeScriptで型やバリデーションを扱うライブラリ
* **React**: Web画面を作るためのJavaScriptライブラリ
* **Amazon Cognito**: AWSが提供するユーザー管理・認証サービス。ユーザーごとに「権限」や「グループ分け」ができる
* **FastAPI**: PythonでAPI（アプリ同士のやりとりの窓口）を作るためのフレームワーク
* **OpenAPI**: APIの仕様を記述するための標準フォーマット

---

## このプロジェクトでやりたいこと

* **サーバーとフロントエンドで同じ型情報を使う**
  サーバー側でデータの型（スキーマ）をPydanticで定義し、それをJSON Schemaという共通形式に変換します。
  そのJSON Schemaを使って、フロントエンド側（TypeScript）でも同じ型情報やバリデーション（入力チェック）を利用します。

* **フォームの自動生成と柔軟なUI**
  フロントエンドでは、JSON Schemaからフォームの構造や入力チェックを自動で作成します。
  フォームの見た目や使い勝手は、Reactのいろいろなライブラリ（JSON Forms、React Hook Formなど）から選べます。

* **ユーザー権限によるUI制御**
  Amazon Cognitoで管理している「ユーザーの役割」や「グループ」に応じて、フォームのボタン表示や操作可能な部分を自動で切り替えます。

* **API仕様の自動生成**
  サーバー側の型情報（Pydanticモデル）から、APIの仕様書（OpenAPI）も自動で作ります。

---

## 技術構成

* **バックエンド（サーバー側）**

  * Python
  * Pydantic（型・バリデーション定義）
  * FastAPI（API作成・OpenAPI自動生成）
  * AWS SDK（Boto3、Cognito連携）

* **共通形式**

  * JSON Schema（Pydanticから自動生成）

* **フロントエンド（画面側）**

  * TypeScript
  * Zod（型・バリデーション）
  * React
  * AWS Amplify（Cognito認証）
  * フォーム生成ライブラリ（JSON Forms、React Hook Formなど）

* **権限管理**

  * Amazon Cognito（ユーザー管理、グループ、カスタム属性）
  * JWTトークン（認証情報のやりとり）

---

## システムの流れ（イメージ）

1. **サーバー側**

   * Pydanticでフォームの型（スキーマ）を定義し、JSON Schemaとして公開
   * Cognitoでユーザーの権限やグループを管理
   * フォームごとに「どのボタンを誰が操作できるか」などの情報もメタデータとして提供
   * FastAPIでAPIを作り、OpenAPI仕様も自動生成

2. **フロントエンド側**

   * AWS AmplifyでCognito認証を行い、JWTトークンからユーザーの権限情報を取得
   * JSON SchemaからZodスキーマを生成し、フォームを自動生成
   * 権限情報に基づいて、フォームのボタン表示や操作可否を切り替え
   * 入力データをZodで検証し、API経由でサーバーに送信

3. **サーバーでの検証**

   * Pydanticでデータの正しさを再度チェック
   * Cognitoトークンでユーザー権限を確認し、許可されていない操作はブロック

---

## この仕組みで得られるメリット

* **型安全と権限制御の統合**
  サーバーもフロントエンドも同じ型情報を使うので、ミスが減り安全性が高まります。ユーザー権限も一元管理できます。

* **フォームの一元化・自動生成**
  型情報からフォームやバリデーション、UIを自動生成でき、保守や変更が簡単です。

* **API仕様の自動生成**
  サーバーの型定義からAPI仕様書（OpenAPI）が自動生成されるので、ドキュメント管理やクライアントコード生成が効率化します。

* **柔軟なUI制御**
  ユーザーの役割に応じてフォームUIを自動で切り替え、最適なユーザー体験を提供できます。

* **セキュリティと保守性の向上**
  権限管理とデータ構造管理をそれぞれCognitoとJSON Schemaで一元化し、クライアント・サーバー両方で権限チェックを行うことでセキュリティも強化されます。

---

## まとめ

**BSS-FormFlow**は、

* 型安全性
* 権限制御
* フォーム自動生成
* API仕様自動化
  を実現し、開発効率と保守性、セキュリティを高めるための仕組みです。
